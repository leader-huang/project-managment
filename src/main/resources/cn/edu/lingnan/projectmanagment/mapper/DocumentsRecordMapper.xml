<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.edu.lingnan.projectmanagment.mapper.DocumentsRecordMapper">
    <select id="getById" resultType="DocumentsRecord">
        select * from documents_record where delete_flag = 0 and id = #{id}
    </select>
    <select id="getAllByProjectId" resultType="DocumentsRecord">
        select * from documents_record where delete_flag = 0 and project_id = #{projectId} order by id desc
    </select>

    <update id="delete">
        update documents_record set delete_flag = 1 where id = #{id};
    </update>

    <update id="update">
        update documents_record set
        <trim suffixOverrides=",">
            <if test="projectId != null">
                project_id = #{projectId},
            </if>
            <if test="userId != null">
                user_id = #{userId},
            </if>
            <if test="operateTime != null">
                operate_time = #{operateTime},
            </if>
            <if test="ip != null">
                ip = #{ip},
            </if>
            <if test="operateMessage != null">
                operate_message = #{operateMessage},
            </if>
        </trim>
        where id = #{id}
    </update>

    <insert id="insert">
        insert into documents_record
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="projectId != null">
                project_id,
            </if>
            <if test="userId != null">
                user_id,
            </if>
            <if test="operateTime != null">
                operate_time,
            </if>
            <if test="ip != null">
                ip,
            </if>
            <if test="operateMessage != null">
                operate_message,
            </if>
        </trim>
        values
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="projectId != null">
                #{projectId},
            </if>
            <if test="userId != null">
                #{userId},
            </if>
            <if test="operateTime != null">
                #{operateTime},
            </if>
            <if test="ip != null">
                #{ip},
            </if>
            <if test="operateMessage != null">
                #{operateMessage},
            </if>
        </trim>
    </insert>

    <!--查找所有被注销记录-->
    <select id="getAllDeleteDocumentsRecord" resultType="DocumentsRecord">
        select * from documents_record where delete_flag=1
    </select>

    <!--撤消一条记录-->
    <update id="undo">
        update documents_record set delete_flag = 0 where id = #{id}
    </update>
</mapper>